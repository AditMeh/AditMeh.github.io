<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Mixed Radix Decomposition | Aditya Mehrotra </title> <meta name="author" content="Aditya Mehrotra"> <meta name="description" content="Converting a many-class problem into multiple smaller subproblems"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%90%A6&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="adityamehrotra.ca/blog/Mixed-Radix-Decomposition/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Aditya </span> Mehrotra </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Mixed Radix Decomposition</h1> <p class="post-meta"> February 18, 2026 </p> <p class="post-tags"> <a href="/blog/2026"> <i class="fa-solid fa-calendar fa-sm"></i> 2026 </a>   ·   <a href="/blog/tag/computer-vision"> <i class="fa-solid fa-hashtag fa-sm"></i> computer_vision</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>This was a trick I studied when looking at TabICL’s codebase, that actually had a lot more depth than I imagined.</p> <h2 id="problem-statement">Problem Statement</h2> <p>You can only train a classifier of max \(C\) classes, but you want to get a classifier for \(N &gt; C\) classes. You can train multiple classifiers, but each is subject to the restriction of having \(C\) classes, how do you do this?</p> <p>We’d want to somehow break the class index \(c \in \{0, \dots, N-1\}\) into a tuple of elements, each of which vary from \(0 \dots C\). We then can train a classifier on each element of the tuple.</p> <h2 id="theory">Theory</h2> <p>To represent our own number system, we break down an integer \(x\) as an addition of powers of 10, with “digits” \(x_0 \dots x_{M-1}\):</p> \[x = 10^{M-1} x_{M-1} + 10^{M-2} x_{M-2} + \dots + 10^0 x_0, \quad 0 \leq x_j \leq 9\] <p>We can also do the same for binary:</p> \[x = 2^{M-1} x_{M-1} + 2^{M-2} x_{M-2} + \dots + 2^0 x_{0}, \quad 0 \leq x_j \leq 1\] <p>Mixed radix numeral systems are a generalization of this, where we specify a base \([k_0, \dots, k_{M-1}]\), \(k_i \geq 2\) such that for \(0 \leq x_i &lt; k_i\):</p> \[x = (k_0 k_1 k_2 \dots k_{M-2})x_{M-1} + (k_0k_1k_2\dots k_{M-3})x_{M-2} + \dots + k_{0} x_{1} + x_{0}\] <p>We could just hardcode all \(k_i\)’s to 10 or 2, getting us the decimal and binary number systems directly, so this is a generalization of the previously mentioned number systems. Much like in decimal, we have a set of “digits” \(x_0, \dots, x_{M-1}\) in mixed-radix numeral systems.</p> <p>In this number system, we can represent any integer from \(0\) to \(\prod_{i=0}^{M-1} k_i - 1\). Before we use this for our usecase, I’ll need to show a few basic properties first:</p> <ol> <li>Proof that the maximum possible value is \(\prod_{i=0}^{M-1} k_i - 1\)</li> <li>Proof that every integer \(0 \leq x \leq \prod_{i=0}^{M-1} k_i - 1\) has a unique decomposition (existence and uniqueness)</li> <li>Show how to go from an integer to digits in a mixed-radix numeral system</li> </ol> <h3 id="notation">Notation</h3> <p>Let \(w_i\) be defined as</p> \[w_i = \prod_{j=0}^{i-1} k_j, \quad w_0 = 1\] <h3 id="maximum-possible-value">Maximum Possible Value</h3> <p>We have that an arbitrary integer \(x\) expressed in mixed radix notation with digits \([x_1, \dots, x_{M-1}]\) is,</p> \[x = \sum_{i=0}^{M-1} x_i w_i\] <p>The maximum integer value that \(x\) can take is when all \(x_i = k_i - 1\). So we get that:</p> \[x_{max} = \sum_{i=0}^{M-1} (k_i - 1) w_i\] <p>We observe that \(w_i k_i = w_{i+1}\), therefore via telescoping sums,</p> \[x_{max} = \sum_{i=1}^{M-1} w_{i+1} - w_i = w_{M} - w_0 = \prod_{j=0}^{M-1} k_j - 1\] <p>Hence, we’ve shown the maximum possible integer value attainable by a specific mixed-radix base.</p> <h3 id="existence">Existence</h3> <p>Let \(0 \leq x &lt; \prod_{j=0}^{M-1} k_j = k_0 \dots k_{M-1}\), we want to show that there are digits \(0 \leq x_i &lt; k_i\) such that</p> \[x = (k_0 k_1 k_2 \dots k_{M-2})x_{M-1} + (k_0k_1k_2\dots k_{M-3})x_{M-2} + \dots + k_{0} x_{1} + x_{0}\] <p>There exist unique integers \(x_0\) and \(y_1\) such that</p> \[x = x_0 + k_0 y_1\] <p>Since \(x = x_0 + k_0 y_1 &lt; k_0 \dots k_{M-1}\) and \(x_0 &lt; k_0\), that means that \(y_1 &lt; k_1k_2\dots k_{M-1}\).</p> <p>We can repeat this process, getting us unique integers \(x_1, y_2\) such that \(y_1 = x_1 + k_1 y_2\), and \(y_2 &lt; k_2 \dots k_{M-1}\) and \(x_1 &lt; k_1\).</p> <p>Ultimately, we hit \(y_{M-1} &lt; k_{M-1}\). If we try to do the same trick, getting integers \(x_{M-1}, y_{M}\) such that \(y_{M-1} = x_{M-1} + k_{M-1} y_{M}\), we see that \(y_{M-1} &lt; k_{M-1}\), so \(y_{M} = 0\) and \(x_{M-1} = y_{M-1}\). Thus, we can’t divide further.</p> <p>Back substituting this all, we get:</p> \[x = x_0 + k_0 (x_1 + k_1(x_2 + k_2(\dots))) = x_0 + k_0 x_1 + (k_0k_1) x_2 + \dots + (k_0\dots k_{M-2}) x_{M-1}\] <p>Hence, we’ve proven that we have a set of \(x_i &lt; k_i\) digits which produce any arbitrary integer \(0 \leq x &lt; \prod_{j=0}^{M-1} k_j = k_0 \dots k_{M-1}\) in this number system.</p> <h3 id="uniqueness">Uniqueness</h3> <p>We want to show if there are two integers \(x, y &lt; \prod_{j=1}^{M-1} k_j\) such that \(x = y\), then their digit representations \([a_0,\dots, a_{M-1}]\) and \([b_0, \dots, b_{M-1}]\) are the same (uniqueness). In essence for \(0 \leq a_i, b_i &lt; k_i\):</p> \[\sum_{i=0}^{M-1} a_i w_i = \sum_{i=1}^{M-1} b_i w_i \implies \forall i \in [0, \dots, M-1], \quad a_i=b_i\] <p>Assume that</p> \[\sum_{i=0}^{M-1} a_i w_i = \sum_{i=1}^{M-1} b_i w_i\] <p>So we have that</p> \[\sum_{i=0}^{M-1} (a_i-b_i) w_i = 0\] <p>Let \(c_i = a_i - b_i\), so we have that \(-k_i &lt; c_i &lt; k_i\) and \(\sum_{i=0}^{M-1} c_i w_i = 0\).</p> <p>Case 1, if all \(c_i = 0\), we are done. Assume that there exist an index \(j\) such that \(j = \min \{i : c_i \neq 0 \}\), so \(c_0 = \dots = c_{j-1} = 0\) and \(c_j \neq 0\). We then can rewrite the sum as:</p> \[c_jw_j + \sum_{i = j+1}^{M-1} c_iw_i = 0\] \[c_jw_j + \sum_{i = j+1}^{M-1} c_i w_j \prod_{n=j}^{i-1} k_n = 0 \implies c_j + \sum_{i = j+1}^{M-1} c_i \prod_{n=j}^{i-1} k_n = 0\] <p>When we modulo \(\sum_{i = j+1}^{M-1} c_i \prod_{n=j}^{i-1} k_n\) with \(k_j\), we get 0, meaning it’s divisible by \(k_j\). So reducing the equation under modulo \(k_j\), we get that \(c_j \equiv 0 \mod k_j\), hence \(c_j\) is divisible by \(k_j\).</p> <p>However, \(-k_j &lt; c_j &lt; k_j\), so \(c_j\) must be zero. Hence we have a contradiction. Therefore all \(c_j\)’s must be zero.</p> <h3 id="converting-an-integer-to-a-radix-representation">Converting an Integer to a Radix Representation</h3> <p>To get the digit \(d_i(x)\) for integer \(x\) at index \(i\), we can compute the following:</p> \[d_i(x) = \left\lfloor \frac{x}{w_i} \right\rfloor \mod k_i\] <p>To reason about how this works, we can solve for it algebraically. Recall that our digit representation can be converted to an integer like this:</p> \[x = w_{M-1} x_{M-1} + w_{M-2}x_{M-2} + \dots + w_1 x_{1} + w_0 x_{0}\] <p>Dividing \(x\) by \(w_i\) gets us,</p> \[\frac{x}{w_i} = \frac{w_{M-1}}{w_i} x_{M-1} + \dots + x_i + \dots + \frac{w_0}{w_i}x_{0}\] <p>First, I’ll show that the sum of all terms \(j &lt; i\) is less than 1. Specifically,</p> \[\sum_{j=0}^{i-1} \frac{w_j}{w_i} x_j &lt; 1\] <p>We can expand everything out first,</p> \[\sum_{j=0}^{i-1} \frac{w_j}{w_i} x_j = \sum_{j=0}^{i-1} \frac{\prod_{n=0}^{j-1} k_n}{\prod_{m=0}^{i-1} k_m} x_j = \sum_{j=0}^{i-1} \frac{x_j}{\prod_{m=j}^{i-1} k_m}\] <p>Since we know that \(x_j \leq k_j - 1\), we have a telescoping series,</p> \[\sum_{j=0}^{i-1} \frac{x_j}{\prod_{m=j}^{i-1} k_m} \leq \sum_{j=0}^{i-1} \frac{k_j - 1}{\prod_{m=j}^{i-1} k_m}\] \[= \left(1 - \frac{1}{k_{i-1}}\right) + \left(\frac{1}{k_{i-1}} - \frac{1}{k_{i-1}k_{i-2}}\right) + \dots + \left(\frac{1}{\prod_{m=1}^{i-1} k_m} - \frac{1}{\prod_{m=0}^{i-1} k_m}\right)\] \[= 1 - \frac{1}{\prod_{m=0}^{i-1} k_m} &lt; 1\] <p>Now for all terms \(j &gt; i\),</p> \[\frac{x}{w_i} = x_{M-1} \prod_{n=i}^{M-2}k_n + x_{M-2} \prod_{n=i}^{M-3}k_n + \dots + x_i + \underbrace{\dots + \frac{w_0}{w_i} x_0}_{\text{sums up to} &lt; 1}\] <p>Now it’s easy to see that every single term with \(j &gt; i\) is an integer, that also has \(k_i\) as a factor.</p> \[\frac{x}{w_i} = \underbrace{x_{M-1} \prod_{n=i}^{M-2}k_n + x_{M-2} \prod_{n=i}^{M-3}k_n + \dots}_{\text{integers divisible by } k_i} + x_i + \underbrace{\dots + \frac{w_0}{w_i} x_0}_{\text{sums up to} &lt; 1}\] <p>Now we have enough information to understand what the digit-extraction operation is doing. In \(\left\lfloor \frac{x}{w_i} \right\rfloor \mod k_i\), the floor gets rid of the decimal component from summing the terms with indexes \(j &lt; i\). Then, the \(\mod k_i\) operation gets rid of the terms with higher indexes \(j &gt; i\),</p> \[\left\lfloor \frac{x}{w_i} \right\rfloor \mod k_i = \left(\left(\underbrace{x_{M-1} \prod_{n=i}^{M-2}k_n + \dots}_{\text{integers divisible by } k_i}\right) \mod k_i + x_i \mod k_i\right) \mod k_i\] \[= x_i \mod k_i = x_i\] <p>The last step follows since our digits satisfy \(0 \leq x_i &lt; k_i\).</p> <h2 id="using-it-in-practice">Using It in Practice</h2> <h3 id="picking-bases-and-number-of-digits">Picking Bases and Number of Digits</h3> <p>After all that math, let’s now discuss how to actually use this. Assume we have a classifier that supports \(C\) classes, and we have \(N\) classes. We can construct a set of digits \([k_0, \dots]\), where each \(k_i &lt; C\), allowing us to fit a classifier “per digit”.</p> <p>There are still two things we need to figure out: what our bases \(k_0, \dots\) will be and how many of them we should have.</p> <p>Theoretically, the maximum allowed value for each of the bases \(k\) is \(C-1\), since that’s how many classes our classifier can take. So assuming this, we can compute the minimum number of digits required to represent an integer \(0 \leq x &lt; N\) as</p> \[M = \left\lceil \frac{\log{N}}{\log{C}} \right\rceil \implies M \geq \frac{\log N}{\log C}\] <p>We then get that,</p> \[M\log C \geq \log N \implies C^M \geq N\] <p>Using our equation of maximum possible value expressed by a base in mixed-radix, we get that</p> \[\prod_{j=0}^{M-1} C - 1 = C^{M} - 1 \geq N - 1\] <p>Thus, our system can represent any of the \(N\) classes \(0 \leq x \leq N-1\) with \(M\) digits.</p> <p>We can do a little bit better though. By taking the maximum to be \(\lceil N^{1/M}\rceil\), we have that our maximum attainable value is still within the correct range,</p> \[\prod_{j=0}^{M-1} \lceil N^{1/M} \rceil - 1 \geq (N^{1/M})^{M} - 1 \geq N - 1\] <p>In fact, this is the minimum possible maximum value per digit, if we want even bases. We can easily prove this by assuming there is some \(A &lt; \lceil N^{1/M}\rceil\) that works:</p> \[A &lt; \lceil N^{1/M}\rceil \leq N^{1/M} \implies A^M &lt; N \implies A^M - 1 &lt; N - 1\] <p>Hence, we have a contradiction and we’ve established a tight bound.</p> <h3 id="usage-in-tabicl">Usage in TabICL</h3> <p>The use of this is in encoding labels that exceed the model’s \(C\) - the max label it can output.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Compute balanced bases for mixed-radix decomposition
</span><span class="n">bases</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_compute_mixed_radix_bases</span><span class="p">(</span><span class="n">num_classes</span><span class="p">)</span>
<span class="n">num_digits</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">bases</span><span class="p">)</span>
<span class="n">src_accum</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">zeros_like</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
<span class="n">src_with_y</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="nf">clone</span><span class="p">()</span>

<span class="c1"># Run the set transformer for each digit, accumulate, and average
</span><span class="k">for</span> <span class="n">digit_idx</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_digits</span><span class="p">):</span>
    <span class="n">y_digit</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_extract_mixed_radix_digit</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">digit_idx</span><span class="p">,</span> <span class="n">bases</span><span class="p">)</span>
    <span class="n">y_emb</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">y_encoder</span><span class="p">(</span><span class="n">y_digit</span><span class="p">.</span><span class="nf">float</span><span class="p">())</span>
    <span class="n">src_with_y</span><span class="p">[...,</span> <span class="p">:</span><span class="n">train_size</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">src</span><span class="p">[...,</span> <span class="p">:</span><span class="n">train_size</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">y_emb</span>
    <span class="n">src_accum</span> <span class="o">=</span> <span class="n">src_accum</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="nf">tf_col</span><span class="p">(</span><span class="n">src_with_y</span><span class="p">,</span> <span class="n">train_size</span><span class="o">=</span><span class="bp">None</span> <span class="k">if</span> <span class="n">embed_with_test</span> <span class="k">else</span> <span class="n">train_size</span><span class="p">)</span>

<span class="n">src</span> <span class="o">=</span> <span class="n">src_accum</span> <span class="o">/</span> <span class="n">num_digits</span>
</code></pre></div></div> <p>So first it constructs the bases, and then embeds the mixed radix digit for each index using a SetTransformer. These embeddings are accumulated in <code class="language-plaintext highlighter-rouge">src_accum</code>. Finally, they normalize by the number of digits. This approach scales to many-class problems because it just costs more iterations of the for loop. However, this probably loses signal if the number of classes goes into the tens of thousands, which is honestly not that realistic of a case.</p> </div> </article> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?8664456308d8a0b76907c75d01dd1dbf" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>