<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> NDC projection matrices in OpenGL vs gsplat | Aditya Mehrotra </title> <meta name="author" content="Aditya Mehrotra"> <meta name="description" content="Explaining the difference between conventional camera space to ndc projection matrices in OpenGL and Gsplat's"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%90%A6&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="adityamehrotra.ca/blog/GsplatvsOpenGL-NDC/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?bf50d6d9dd867d3e0f3b0add94449649"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Aditya </span> Mehrotra </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">NDC projection matrices in OpenGL vs gsplat</h1> <p class="post-meta"> September 04, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/computer-vision"> <i class="fa-solid fa-hashtag fa-sm"></i> computer_vision</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>I was reading the <a href="https://arxiv.org/abs/2312.02121" rel="external nofollow noopener" target="_blank">gsplat technical report</a> <a class="citation" href="#ye2024gsplatopensourcelibrarygaussian">(Ye et al., 2024)</a> and saw this formula for the camera-space to clip space conversion matrix. If we want to get to NDC space, we simply divide everything by the \(w\) coordinate.</p> \[P=\left[\begin{array}{cccc} 2 f_x / w &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 2 f_y / h &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; (f+n) /(f-n) &amp; -2 f n /(f-n) \\ 0 &amp; 0 &amp; 1 &amp; 0 \end{array}\right] \hspace{1 cm} \text{Gsplat Cam2Clip}\] <p>This confused me, because I’m used to the OpenGL notation for this sort of matrix, where \(t\) is the top of the viewing volume on the y-axis and \(r\) is the right of the viewing volume (from the camera center) on the x-axis.</p> \[P =\left[\begin{array}{cccc} \frac{n}{r} &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; \frac{n}{t} &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; \frac{-(f+n)}{f-n} &amp; \frac{-2 f n}{f-n} \\ 0 &amp; 0 &amp; -1 &amp; 0 \end{array}\right] \hspace{1 cm} \text{OpenGL CamtoClip}\] <p>Before we start, some terms:</p> <ul> <li>Camera space: After applying W2C transform to world coordinates</li> <li>Clip space: Perspective projection (minus the step of dividing by \(w_{camera} = z_{camera}\), aka depth) and dividing by near plane half-width</li> <li>Screen space: After perspective projection, but no other scaling. Basically just existing on the near plane, with the depth being equal to the focal length.</li> <li>NDC space: Perspective projection and dividing by near plane half-width, to get a point in \([-1,1]\).</li> </ul> <p>All derivations around OpenGL and NDC space are done by referncing the bible <a class="citation" href="#Ahn">(Ahn, n.d.)</a></p> <h2 id="explaining-the-difference">Explaining the difference</h2> <p>The key difference is that in gsplat, the positive z-axis faces into the scene, so our clipping planes are \([near,far]\) rather than \([-near, -far]\), where \(near = n = f\) (focal length). I’m overloading notation, so \(f\) is not the far clipping plane but rather the near plane, which is the focal length.</p> <h3 id="deriving-gsplats-xy-in-ndc">Deriving gsplat’s x/y in NDC</h3> <p>Firstly, check our the w coordinate of our Gsplat projection matrix. It’s equal to the z-coordinate of our point in camera space, so \(w_{clip} = z_{camera}\). In OpenGL, this is \(-z_c\). If we rederive our NDC space \(x_n\), with our \(w\) coordinate being \(z_c\) and \(x_p\) being the projected point onto the near plane:</p> \[\begin{aligned} x_{ndc} &amp; =\frac{2 x_p}{r-l}-\frac{r+l}{r-l} \quad\left(x_p=\frac{n x_{camera}}{z_{camera}}\right) \\ &amp; =\frac{2 \cdot \frac{n \cdot x_{camera}}{z_{camera}}}{r-l}-\frac{r+l}{r-l} \\ &amp; =\frac{2 n \cdot x_{camera}}{(r-l)\left(-z_{camera}\right)}-\frac{r+l}{r-l} \\ &amp; =\frac{\frac{2 n}{r-l} \cdot x_{camera}}{z_{camera}}-\frac{r+l}{r-l} \\ &amp; =\frac{\frac{2 n}{r-l} \cdot x_{camera}}{z_{camera}}+\frac{\frac{r+l}{r-l} \cdot z_{camera}}{z_{camera}} \\ &amp; =(\underbrace{\frac{2 n}{r-l} \cdot x_{camera}+\frac{r+l}{r-l} \cdot z_{camera}}_{x_{clip}}) / z_{camera} \end{aligned}\] <p>\(r\) is the right of the near plane on the x axis and \(l\) is the left. Assuming a symmetric viewing volume, we get that \(r+l = 0 \implies r = -l\), so finally our clip space coordinate \(x_n\) is equal to \(\frac{2n}{r-l} = \frac{n}{r} x_{camera}\). Therefore, our ndc space \(x\) under the OpenGL projection is equal to:</p> \[x_{ndc}^{OpenGL} = \underbrace{(n\frac{x_{camera}}{z_{camera}})}_{\text{persp. projected }x_{camera}} \cdot \underbrace{\frac{1}{r}}_{\text{scaling point to [-1, -1]}}\] <p>Now, if we look at the gsplat matrix, the top left part is \(\frac{2 f_x}{w}\). So the final NDC space x-coordinate is given by:</p> \[x_{ndc}^{gsplat} = \underbrace{(f \frac{x_{camera}}{z_{camera}})}_{\text{persp. projected } x_{camera}} \cdot \underbrace{\frac{1}{s_x}}_{\text{projected screen-space x coordinate in pixels}} \cdot \underbrace{\frac{1}{w/2}}_{\text{scaling pixel to [-1,1]}}\] <p>These operations are doing the same thing, except the gsplat one operates in pixel space, because we divide the perspective projected x-coordinate by width of a pixel, converting the unit from whatever the axes of the screen space represent to pixels. Also, instead of scaling by \(r\), which is the half-width of the near plane in screen space units, we scale by \(w/2\), which is the half width of the near plane in pixels units. Since there are only \(w/2\) pixels in either direction of the x-axis, this rescales our screen space coordinates to \([-1,1]\). Finally, \(near = n = f\), so our perspective projection equations are the same!</p> <p>At the end of the day, we’re getting an output in [-1,1], it’s just that the intermediate units are pixels for gsplat and screen space units for OpenGL.</p> <p>The same analysis can be repeated for \(y_{ndc}\).</p> <h3 id="deriving-gsplats-z-in-ndc">Deriving gsplat’s z in NDC</h3> <p>Now, \(f\) will refer to the far clipping plane rather than focal length.</p> <p>For the z-coordinate, the NDC space derivation works a similar way to the x/y coordinates. Points close to the far clipping plane with camera space values of \((\cdot, \cdot, f)\) are assigned to \(z_{ndc} \approx 1\) and points close to the near clipping plane with values of \((\cdot , \cdot, n)\) are assigned to \(z_{ndc} \approx -1\).</p> <p>Now, we know that \(z_{ndc}\) only relies on \(z_{camera}\) and \(w_{camera}\), which is always equal to 1. We get the following equation after we perform the homogenous coordinate division:</p> \[z_{ndc} = \frac{Az_{camera} + B}{w_{clip}} = \frac{Az_{camera} + B}{z_{camera}}\] <p>Hence, using the input/outputs we had before, we get the following equations.</p> \[\left\{\begin{array} { l } { \frac { A n + B } { n } = - 1 } \\ { \frac { A f + B } { f } = 1 } \end{array} \rightarrow \left\{\begin{array}{l} A n+B=-n \\ A f+B=f \end{array}\right.\right.\] <p>Skipping some steps, this gets us that \(A = \frac{f+n}{f-n}\) and that \(B = \frac{-2fn}{f-n}\). These are exactly the two values of the gsplat matrix in the z-coordinate column.</p> <p>To summarize, once we rederive everything with the z-axis facing into the scene, we recover the gsplat matrix.</p> <h2 id="conclusion">Conclusion</h2> <p>We explained why the gsplat matrix is the same as the opengl matrix, just with a different axis direction for \(z\) and intermediate units for NDC conversion.</p> </div> </article> </div> </div> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?8664456308d8a0b76907c75d01dd1dbf" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>